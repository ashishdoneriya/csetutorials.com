<!doctype html><html lang=hi><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAQAAABLCVATAAAAdUlEQVR4Ae3MIRJAUBCH8e81R3AO53AmvIQmu5MzqE8iKoZAEdZYZhT7/cuGnR9/yeEJrDcW8DjEKlbFasQmFTQitj+cK2TqO8ggg2LceygiZ6YjeQel9Me10NI8ghR7DhlkkEFBxQTEShVUcVHGcAsZ8PylDecfc51kCzSlAAAAAElFTkSuQmCC type=image/x-icon><link rel=preload href=https://csetutorials.com/fonts/Roboto.ttf as=font type=font/ttf crossorigin=anonymous><link rel=preload href=https://csetutorials.com/fonts/RobotoMono.ttf as=font type=font/ttf crossorigin=anonymous><link rel=preload href=https://csetutorials.com/fonts/Roboto-Italic.ttf as=font type=font/ttf crossorigin=anonymous><link rel=preload href=https://csetutorials.com/fonts/RobotoMono-Italic.ttf as=font type=font/ttf crossorigin=anonymous><link rel=stylesheet href=https://csetutorials.com/scss/main.min.css><title>Distributed Leaderboard System Design</title>
<meta name=description content="Distributed Leaderboard System Design"><meta name=author content="Ashish Doneriya"><meta name=robots content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"><link rel=canonical href=https://csetutorials.com/distributed-leaderboard-system-design.html><meta property="og:type" content="article"><meta property="og:title" content="Distributed Leaderboard System Design"><meta property="og:description" content="Distributed Leaderboard System Design"><meta property="og:url" content="https://csetutorials.com/distributed-leaderboard-system-design.html"><meta property="og:site_name" content="Cse Tutorials"><meta property="article:published_time" content="2022-05-02T07:21:55+05:30"><meta property="article:modified_time" content="2022-05-02T07:21:55+05:30"><meta property="article:author" content="Ashish Doneriya"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Distributed Leaderboard System Design"><meta name=twitter:description content="Distributed Leaderboard System Design"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","headline":"Distributed Leaderboard System Design","description":"Distributed Leaderboard System Design","author":{"@type":"Person","name":"Ashish Doneriya"},"keywords":[],"articleSection":["\"%!s(MISSING)\""],"datePublished":"2022-05-02T07:21:55\u002b05:30","dateModified":"2022-05-02T07:21:55\u002b05:30","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/csetutorials.com\/distributed-leaderboard-system-design.html"},"url":"https:\/\/csetutorials.com\/distributed-leaderboard-system-design.html"}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-VQ66771MZZ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VQ66771MZZ")</script></head><body><nav class="navbar navbar-expand-lg navbar-dark bg-dark"><div class=container><a class=navbar-brand href=/>Cse Tutorials</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse justify-content-end" id=navbarNav><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/about-us/>About us</a></li><li class=nav-item><a class=nav-link href=/contact-us/>Contact us</a></li><li class=nav-item><a class=nav-link href=/privacy-policy/>Privacy Policy</a></li><li class=nav-item><a class=nav-link href=/terms-of-service/>Terms of Service</a></li><li class=nav-item><a class=nav-link href=/topics/>Topics</a></li></ul></div></div></nav><main><article class=page-wrapper><h1 class="mb-4 text-center">Distributed Leaderboard System Design</h1><div class="d-flex justify-content-center align-items-center mb-4 text-muted small"><time datetime="2022-05-02 07:21:55 +0530 +0530">May 2, 2022</time>
<span class=mx-2>|</span>
<span>Ashish Doneriya</span>
<span class=mx-2>|</span>
<a class=text-decoration-none href=/topics/system-design rel=category>System Design</a></div><div class=post-content><h3 id=requirements>Requirements</h3><ul><li>100 million requests per second</li><li>Leaderboard should be updated as soon as possible</li></ul><h3 id=components-of-the-system>Components of the system</h3><ul><li>Key-Value database</li><li>Webservers</li><li>Load Balancers</li><li>Cache Service</li><li>Queues</li></ul><h3 id=data-flow>Data Flow</h3><h3 id=summary>Summary</h3><p>The user&rsquo;s request to update score would go to the webservers. The webserver send the request to the queue. From queue, a set of workers fetch the individual request, fetch the user&rsquo;s current score from the key-value db and adding the increment, updating the new score to the db then send the updated score to the batch queue (combining multiple user&rsquo;s scores). From the batch queue workers would fetch data in batches and send to another queues for batches and the process goes on untill there is just single record. At the end the top 10 record is updated to the cache and db for the webservers to fetch and show it to the ui.</p><h3 id=details>Details</h3><ol><li>The user&rsquo;s request would first pass through the load balancer and the load balancer would distribute the requests to the web servers.</li><li>The webserver send the request to a queue in async (lets say queue1) and send the success response.</li><li>From queue1 there are workers machines which would process each request.</li><li>These worker machines will fetch the user&rsquo;s current score from the database (key-value pair because I don&rsquo;t think relational data could scale to that much extent).</li><li>It will calculate new score by summing up current score and new points.</li><li>After then the new score is updated to the db (These should be a two-phase locking mechanism in case two different worker machines try to update the value, or consistent hashing can be applied by load balancer) and the new score is passed to a queue (lets say queue2).</li><li>From queue2, a set of worker machines fetches records, create batch of records and send to another queue3. Then another worker machines fetch those batches in batches process them, calcuate top 10 or 100 and pass to another queue. This process will go on untill it reaches the last queue (at around level 10).</li><li>From the last queue the batch will be fetched and saved in the cache and db.</li></ol><p>There is another alternative to this. We can use redis sorted set. For that the steps from <strong>1</strong> to <strong>6</strong> are same. The rest steps are -<br>7. From queue2, a set of worker machines fetches records individually and saves them in redis sorted set.<br>8. At every fixed interval, a process will remove all record other than top X from redis sorted set, fetch the top X and update to the cache and db. So that the leaderboard could be fetched directly from cache.</p><p><strong>Source</strong><br><a href=https://engg.glance.com/how-we-built-a-distributed-leaderboard-system-in-a-week-c8b1a63083ed target=_blank rel="noopener nofollow">How we built a Distributed Leaderboard System in a Week</a></p></div></article></main><script async src=https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js defer></script></body></html>