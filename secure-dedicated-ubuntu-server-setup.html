<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAQAAABLCVATAAAAdUlEQVR4Ae3MIRJAUBCH8e81R3AO53AmvIQmu5MzqE8iKoZAEdZYZhT7/cuGnR9/yeEJrDcW8DjEKlbFasQmFTQitj+cK2TqO8ggg2LceygiZ6YjeQel9Me10NI8ghR7DhlkkEFBxQTEShVUcVHGcAsZ8PylDecfc51kCzSlAAAAAElFTkSuQmCC type=image/x-icon><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wdth,wght@0,75..100,100..900;1,75..100,100..900&family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel=stylesheet><link rel=stylesheet href=https://csetutorials.com/scss/main.min.css><title>Secure and Optimize Your Dedicated Ubuntu Server for Production"</title>
<meta name=description content="Dedicated Ubuntu server setup with SSH key login, firewall rules, DDoS protection, and network tuning for secure, high-performance deployments."><meta name=author content="Ashish Doneriya"><meta name=robots content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"><link rel=canonical href=https://csetutorials.com/secure-dedicated-ubuntu-server-setup.html><meta property="og:type" content="article"><meta property="og:title" content='Secure and Optimize Your Dedicated Ubuntu Server for Production"'><meta property="og:description" content="Dedicated Ubuntu server setup with SSH key login, firewall rules, DDoS protection, and network tuning for secure, high-performance deployments."><meta name=keywords content="ubuntu,dedicated server,hetzner"><meta property="og:url" content="https://csetutorials.com/secure-dedicated-ubuntu-server-setup.html"><meta property="og:site_name" content="Cse Tutorials"><meta property="article:published_time" content="2025-07-11T10:00:00+05:30"><meta property="article:modified_time" content="2025-07-11T10:00:00+05:30"><meta property="article:author" content="Ashish Doneriya"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content='Secure and Optimize Your Dedicated Ubuntu Server for Production"'><meta name=twitter:description content="Dedicated Ubuntu server setup with SSH key login, firewall rules, DDoS protection, and network tuning for secure, high-performance deployments."><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","headline":"Secure and Optimize Your Dedicated Ubuntu Server for Production\u0022","description":"Dedicated Ubuntu server setup with SSH key login, firewall rules, DDoS protection, and network tuning for secure, high-performance deployments.","author":{"@type":"Person","name":"Ashish Doneriya"},"keywords":["\"%!s(MISSING)\", \"%!s(MISSING)\", \"%!s(MISSING)\""],"articleSection":["\"%!s(MISSING)\""],"datePublished":"2025-07-11T10:00:00\u002b05:30","dateModified":"2025-07-11T10:00:00\u002b05:30","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/csetutorials.com\/secure-dedicated-ubuntu-server-setup.html"},"url":"https:\/\/csetutorials.com\/secure-dedicated-ubuntu-server-setup.html"}</script></head><body><nav class="navbar navbar-expand-lg navbar-dark bg-dark"><div class=container><a class=navbar-brand href=/>Cse Tutorials</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse justify-content-end" id=navbarNav><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/about-us/>About us</a></li><li class=nav-item><a class=nav-link href=/contact-us/>Contact us</a></li><li class=nav-item><a class=nav-link href=/privacy-policy/>Privacy Policy</a></li><li class=nav-item><a class=nav-link href=/terms-of-service/>Terms of Service</a></li><li class=nav-item><a class=nav-link href=/topics/>Topics</a></li></ul></div></div></nav><main><article class=page-wrapper><h1 class="mb-4 text-center">Secure Dedicated Ubuntu Server Setup with SSH Keys, Firewall, DDoS Protection, and Network Optimization</h1><div class="d-flex justify-content-center align-items-center mb-4 text-muted small"><time datetime="2025-07-11 10:00:00 +0530 +0530">Jul 11, 2025</time>
<span class=mx-2>|</span>
<span>Ashish Doneriya</span>
<span class=mx-2>|</span>
<a class=text-decoration-none href=/topics/ubuntu rel=category>Ubuntu</a></div><div class=post-content><h2 id=table-of-contents>Table of Contents</h2><ol><li><a href=#1-create-a-dedicated-user-account>Create a Dedicated User Account</a></li><li><a href=#2-generate-ssh-key-pair>Generate SSH Key Pair</a></li><li><a href=#3-configure-key-based-ssh-login>Configure Key-Based SSH Login</a></li><li><a href=#4-disable-root-login-and-password-authentication>Disable Root Login and Password Authentication</a></li><li><a href=#5-enable-and-configure-ufw-firewall>Enable and Configure UFW Firewall</a></li><li><a href=#6-install-fail2ban-for-brute-force-protection>Install fail2ban for Brute-Force Protection</a></li><li><a href=#7-enable-automatic-security-updates>Enable Automatic Security Updates</a></li><li><a href=#8-scan-for-rootkits-and-audit-security>Scan for Rootkits and Audit Security</a></li><li><a href=#9-accept-unlimited-number-of-requests>Accept Unlimited Number of Requests</a></li><li><a href=#10-boost-network-throughput-with-tcp-bbr>Boost Network Throughput with TCP BBR</a></li><li><a href=#11-mitigate-ddos-attacks>Mitigate DDoS Attacks</a></li><li><a href=#12-use-haproxy-for-advanced-layer-7-filtering>Use HAProxy for Advanced Layer 7 Filtering</a></li></ol><p>Provisioning a fresh Ubuntu server, especially on dedicated hardware like Hetzner,requires immediate hardening to prevent compromise and support scale. This guide walks through all essential steps: creating a secure user, enforcing SSH key-only login, disabling root and password authentication, locking down open ports via UFW, and tuning system limits for high concurrency. This guide also includes protections against brute-force attempts, SYN flood attacks, and other common threats, and applies TCP BBR to maximize sustained throughput. This leaves no open surfaces beyond what you explicitly allow.</p><blockquote><p><strong>Assumption</strong>: You are working with a freshly provisioned dedicated Ubuntu server (such as from Hetzner) that initially allows direct <code>root</code> login via SSH.</p></blockquote><h2 id=1-create-a-dedicated-user-account>1. Create a Dedicated User Account</h2><p>Use <code>useradd</code> to create a user with a home directory, user group, bash shell, and system-level privileges:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo useradd --create-home --system --shell /bin/bash --user-group ashish
</span></span></code></pre></div><p>Replace <code>ashish</code> with your desired login name if you want to use a different user.</p><h3 id=add-user-to-sudoers>Add User to <code>sudoers</code></h3><p>To give the user admin privileges:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo usermod -aG sudo ashish
</span></span></code></pre></div><p>This allows the user to run commands with <code>sudo</code>.</p><h2 id=2-generate-ssh-key-pair>2. Generate SSH Key Pair</h2><h3 id=on-your-local-machine-recommended>On Your Local Machine (Recommended):</h3><p>Generate the key pair outside the server, on your own system:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-keygen -t rsa -b <span style=color:#ae81ff>4096</span> -f ~/ashish_key.pem -C <span style=color:#e6db74>&#34;ashish@server&#34;</span>
</span></span><span style=display:flex><span>mv ~/ashish_key.pem.pub ~/ashish_key.pub
</span></span></code></pre></div><p>This generates:</p><ul><li><code>~/ashish_key.pem</code> (private key on your local machine)</li><li><code>~/ashish_key.pub</code> (public key on your local machine)</li></ul><h2 id=3-configure-key-based-ssh-login>3. Configure Key-Based SSH Login</h2><p>Copy the public key from your local machine to the server as <code>root</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>scp ~/ashish_key.pub root@your-server-ip:/tmp/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Now, on the server:</span>
</span></span><span style=display:flex><span>sudo mkdir -p /home/ashish/.ssh
</span></span><span style=display:flex><span>sudo cp /tmp/ashish_key.pub /home/ashish/.ssh/authorized_keys
</span></span><span style=display:flex><span>sudo chmod <span style=color:#ae81ff>700</span> /home/ashish/.ssh
</span></span><span style=display:flex><span>sudo chmod <span style=color:#ae81ff>600</span> /home/ashish/.ssh/authorized_keys
</span></span><span style=display:flex><span>sudo chown -R ashish:ashish /home/ashish
</span></span><span style=display:flex><span>sudo rm /tmp/ashish_key.pub
</span></span></code></pre></div><p>You already have the private key (<code>~/ashish_key.pem</code>) on your local machine. No need to download anything from the server.</p><p>Use it to login:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh -i ~/ashish_key.pem ashish@your-server-ip
</span></span></code></pre></div><h2 id=4-disable-root-login-and-password-authentication>4. Disable Root Login and Password Authentication</h2><p>Edit SSH configuration:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nano /etc/ssh/sshd_config
</span></span></code></pre></div><p>Set the following:</p><pre tabindex=0><code class=language-conf data-lang=conf>PermitRootLogin no
PasswordAuthentication no
PermitEmptyPasswords no
ChallengeResponseAuthentication no
UsePAM yes
UseDNS no
AllowUsers ashish
</code></pre><p>Then restart SSH:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl restart ssh
</span></span></code></pre></div><h2 id=5-enable-and-configure-ufw-firewall>5. Enable and Configure UFW Firewall</h2><p>To harden your firewall:</p><ol><li>Deny all incoming and outgoing traffic by default</li><li>Allow only essential ports for your use case (SSH, HTTP, HTTPS, 8080)</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install ufw -y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Set default policies</span>
</span></span><span style=display:flex><span>sudo ufw default deny incoming
</span></span><span style=display:flex><span>sudo ufw default deny outgoing
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Allow essential inbound ports</span>
</span></span><span style=display:flex><span>sudo ufw allow OpenSSH
</span></span><span style=display:flex><span>sudo ufw allow 80/tcp
</span></span><span style=display:flex><span>sudo ufw allow 443/tcp
</span></span><span style=display:flex><span>sudo ufw allow 8080/tcp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Allow necessary outbound connections (optional, adjust per app needs)</span>
</span></span><span style=display:flex><span>sudo ufw allow out <span style=color:#ae81ff>53</span>        <span style=color:#75715e># DNS resolution</span>
</span></span><span style=display:flex><span>sudo ufw allow out 80/tcp    <span style=color:#75715e># HTTP client</span>
</span></span><span style=display:flex><span>sudo ufw allow out 443/tcp   <span style=color:#75715e># HTTPS client</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Finally, enable the firewall</span>
</span></span><span style=display:flex><span>sudo ufw enable
</span></span></code></pre></div><h2 id=6-install-fail2ban-for-brute-force-protection>6. Install fail2ban for Brute-Force Protection</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install fail2ban -y
</span></span><span style=display:flex><span>sudo systemctl enable fail2ban --now
</span></span></code></pre></div><p>Check status:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo fail2ban-client status sshd
</span></span></code></pre></div><h2 id=7-enable-automatic-security-updates>7. Enable Automatic Security Updates</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install unattended-upgrades -y
</span></span><span style=display:flex><span>sudo dpkg-reconfigure --priority<span style=color:#f92672>=</span>low unattended-upgrades
</span></span></code></pre></div><h2 id=8-scan-for-rootkits-and-audit-security>8. Scan for Rootkits and Audit Security</h2><h3 id=rkhunter>rkhunter:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install rkhunter -y
</span></span><span style=display:flex><span>sudo rkhunter --update
</span></span><span style=display:flex><span>sudo rkhunter --propupd
</span></span><span style=display:flex><span>sudo rkhunter --check
</span></span></code></pre></div><h3 id=lynis>lynis:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install lynis -y
</span></span><span style=display:flex><span>sudo lynis audit system
</span></span></code></pre></div><h2 id=9-accept-unlimited-number-of-requests>9. Accept Unlimited Number of Requests</h2><p>To configure your Ubuntu server to accept a high volume of incoming connections (e.g., from web clients or load balancers), tune the system-level limits and network settings:</p><h3 id=run-this-script>Run This Script</h3><p>Create and run the following setup script:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF | sudo tee /usr/local/bin/unlock-ubuntu-capacity.sh
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># Set file limits
</span></span></span><span style=display:flex><span><span style=color:#e6db74>cat &lt;&lt;LIMITS | sudo tee -a /etc/security/limits.conf
</span></span></span><span style=display:flex><span><span style=color:#e6db74>* soft nofile 1048576
</span></span></span><span style=display:flex><span><span style=color:#e6db74>* hard nofile 1048576
</span></span></span><span style=display:flex><span><span style=color:#e6db74>LIMITS
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># Ensure pam_limits is active
</span></span></span><span style=display:flex><span><span style=color:#e6db74>if ! grep -q pam_limits.so /etc/pam.d/common-session; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  echo &#39;session required pam_limits.so&#39; | sudo tee -a /etc/pam.d/common-session
</span></span></span><span style=display:flex><span><span style=color:#e6db74>fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># Set sysctl values
</span></span></span><span style=display:flex><span><span style=color:#e6db74>cat &lt;&lt;SYSCTL | sudo tee -a /etc/sysctl.conf
</span></span></span><span style=display:flex><span><span style=color:#e6db74>fs.file-max = 2097152
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.core.somaxconn = 65535
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.core.netdev_max_backlog = 65535
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.ipv4.tcp_max_syn_backlog = 65535
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.ipv4.ip_local_port_range = 1024 65535
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.ipv4.tcp_tw_reuse = 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SYSCTL
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># Apply immediately
</span></span></span><span style=display:flex><span><span style=color:#e6db74>sudo sysctl -p
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Make it executable and run it</span>
</span></span><span style=display:flex><span>sudo chmod +x /usr/local/bin/unlock-ubuntu-capacity.sh
</span></span><span style=display:flex><span>sudo /usr/local/bin/unlock-ubuntu-capacity.sh
</span></span></code></pre></div><h2 id=10-boost-network-throughput-with-tcp-bbr>10. Boost Network Throughput with TCP BBR</h2><p>To improve sustained network throughput and prevent post-burst throttling (common on Hetzner servers), enable TCP BBR congestion control:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo tee /etc/sysctl.d/99-bbr.conf <span style=color:#e6db74>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.core.default_qdisc = fq
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.ipv4.tcp_congestion_control = bbr
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo sysctl --system
</span></span></code></pre></div><p>Verify BBR is enabled:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sysctl net.ipv4.tcp_congestion_control
</span></span><span style=display:flex><span>lsmod | grep bbr
</span></span></code></pre></div><p>Expected output:</p><pre tabindex=0><code>net.ipv4.tcp_congestion_control = bbr
bbr    20480  0
</code></pre><p>This change helps maintain high transfer speeds after the initial bandwidth burst period, especially under Hetzner&rsquo;s default network shaping.</p><p>After enabling BBR and applying all sysctl changes, a reboot is required for full activation of kernel-level parameters.</p><blockquote><p><strong>Important:</strong> On both Hetzner Dedicated and Hetzner Cloud servers, <strong>do not reboot using <strong><strong>``</strong></strong> or any CLI command</strong>. Always use the Hetzner Web Console to send the reboot signal. Rebooting via CLI can result in permanent network loss due to DHCP or NIC reinitialization failures specific to Hetzner infrastructure.</p></blockquote><h2 id=11-mitigate-ddos-attacks>11. Mitigate DDoS Attacks</h2><p>While Hetzner provides upstream filtering against volumetric attacks, on-host protection is still necessary to guard against smaller floods or malformed traffic.</p><h3 id=block-syn-flood>Block SYN Flood</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Drop packets that are new but not SYN (possible invalid requests)</span>
</span></span><span style=display:flex><span>sudo iptables -A INPUT -p tcp ! --syn -m state --state NEW -j DROP
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Drop all fragmented packets (used in evasion techniques)</span>
</span></span><span style=display:flex><span>sudo iptables -A INPUT -f -j DROP
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Drop packets with all flags set (malformed)</span>
</span></span><span style=display:flex><span>sudo iptables -A INPUT -p tcp --tcp-flags ALL ALL -j DROP
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Drop packets with no flags (null scans)</span>
</span></span><span style=display:flex><span>sudo iptables -A INPUT -p tcp --tcp-flags ALL NONE -j DROP
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Drop SYN+FIN combinations (invalid)</span>
</span></span><span style=display:flex><span>sudo iptables -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Drop SYN+RST combinations (conflicting state)</span>
</span></span><span style=display:flex><span>sudo iptables -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP
</span></span></code></pre></div><h3 id=limit-connections-per-ip>Limit Connections Per IP</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Limit incoming TCP connections to port 80 (HTTP) from a single IP</span>
</span></span><span style=display:flex><span><span style=color:#75715e># If a single IP tries to establish more than 50000 concurrent TCP connections, drop new ones</span>
</span></span><span style=display:flex><span>sudo iptables -A INPUT -p tcp --syn --dport <span style=color:#ae81ff>80</span> -m connlimit --connlimit-above <span style=color:#ae81ff>50000</span> -j REJECT
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Same limit for HTTPS (port 443)</span>
</span></span><span style=display:flex><span>sudo iptables -A INPUT -p tcp --syn --dport <span style=color:#ae81ff>443</span> -m connlimit --connlimit-above <span style=color:#ae81ff>50000</span> -j REJECT
</span></span></code></pre></div><p>To persist:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install iptables-persistent -y
</span></span><span style=display:flex><span>sudo netfilter-persistent save
</span></span></code></pre></div><h3 id=kernel-tweaks-to-support-tcp-flood-resistance>Kernel Tweaks to Support TCP Flood Resistance</h3><p>Also consider enabling the following kernel parameters to strengthen TCP connection handling during floods:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Enables SYN cookies to handle half-open connections without reserving memory</span>
</span></span><span style=display:flex><span>net.ipv4.tcp_syncookies <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Reduces the number of retries for completing the handshake</span>
</span></span><span style=display:flex><span>net.ipv4.tcp_synack_retries <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>
</span></span></code></pre></div><p>Add these to <code>/etc/sysctl.conf</code> and reload:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo -e <span style=color:#e6db74>&#34;net.ipv4.tcp_syncookies=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.ipv4.tcp_synack_retries=2&#34;</span> | sudo tee -a /etc/sysctl.conf
</span></span><span style=display:flex><span>sudo sysctl -p
</span></span></code></pre></div><h3 id=why-this-works>Why This Works</h3><p>After this threshold, additional new connection attempts from that IP will be temporarily dropped. This mechanism primarily protects against automated connection floods and port scanners.</p><p>This limit applies specifically to new TCP connections, not individual HTTP requests. In modern web applications, most browsers and HTTP clients use connection reuse (keep-alive) and multiplexing (especially with HTTP/2), allowing multiple resources to be fetched over a single TCP connection. So while each static asset could technically initiate a new HTTP request, it does not create a new TCP connection every time. Therefore, browsers can load many resources in parallel without triggering this connection rate limit—unless they open many distinct TCP sessions in rapid succession.</p><p>This strategy won’t block typical browser behavior but will throttle abusive clients trying to overwhelm your server with excessive TCP handshakes.</p><h2 id=12-use-haproxy-for-advanced-layer-7-filtering>12. Use HAProxy for Advanced Layer 7 Filtering</h2><p>While iptables protects at the TCP layer, you can use <a href=https://www.haproxy.org/ target=_blank rel="noopener nofollow">HAProxy</a> as a reverse proxy to enforce HTTP-layer restrictions and mitigate abusive clients based on their request behavior — regardless of exact path.</p><p>Install HAProxy:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt update <span style=color:#f92672>&amp;&amp;</span> sudo apt install haproxy -y
</span></span></code></pre></div><p>A sample rule to automatically track high-rate request senders without hardcoding any path:</p><pre tabindex=0><code class=language-haproxy data-lang=haproxy>frontend http-in
    bind *:80
    stick-table type ip size 1m expire 5s store http_req_rate(5s)
    http-request track-sc0 src
    http-request deny if { sc_http_req_rate gt 50 }
    default_backend servers

backend servers
    server app1 127.0.0.1:8080 check
</code></pre><p>This blocks clients sending more than 50 HTTP requests in 5 seconds, regardless of the path or headers. You can further customize based on method, user-agent, or headers if needed.</p><h2 id=summary>Summary</h2><p>Your Ubuntu server is now production-grade secure and tuned for high load:</p><ul><li>You have a dedicated sudo-enabled user with SSH key-only authentication</li><li>Root login and all password-based SSH logins are fully disabled</li><li>Only required inbound ports (22, 80, 443, 8080) are open via UFW; everything else is denied</li><li>Fail2ban protects against brute-force login attempts</li><li>Unattended upgrades ensure the system stays patched</li><li>Kernel and user-level limits have been increased for high concurrency</li><li>TCP BBR congestion control ensures reliable high-speed throughput under Hetzner&rsquo;s network shaping</li><li>Intrusion detection tools (rkhunter, lynis) are available for auditing and anomaly detection</li></ul><p>This setup is suitable for handling production workloads with a strong focus on security and scalability.</p></div></article></main><script async src=https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js defer></script></body></html>